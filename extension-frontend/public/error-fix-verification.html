<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EcoShop Error Fix Verification</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .container {
            background: white;
            border-radius: 16px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }
        
        .header {
            text-align: center;
            margin-bottom: 40px;
        }
        
        .header h1 {
            color: #1f2937;
            margin: 0 0 10px 0;
            font-size: 2.5rem;
        }
        
        .header p {
            color: #6b7280;
            font-size: 1.1rem;
        }
        
        .test-section {
            margin: 30px 0;
            padding: 20px;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
        }
        
        .test-section h3 {
            color: #374151;
            margin: 0 0 15px 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .status-indicator {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #94a3b8;
            position: relative;
        }
        
        .status-indicator.success {
            background: #10b981;
        }
        
        .status-indicator.error {
            background: #ef4444;
        }
        
        .test-button {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 10px 10px 0;
            transition: all 0.2s;
        }
        
        .test-button:hover {
            background: #2563eb;
            transform: translateY(-1px);
        }
        
        .test-button.cart { background: #10b981; }
        .test-button.dashboard { background: #8b5cf6; }
        .test-button.feedback { background: #f59e0b; }
        .test-button.alternatives { background: #ef4444; }
        
        .console-output {
            background: #1f2937;
            color: #e5e7eb;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Monaco', 'Consolas', monospace;
            font-size: 14px;
            max-height: 200px;
            overflow-y: auto;
            margin-top: 15px;
        }
        
        .product-mock {
            background: #f9fafb;
            border: 1px solid #e5e7eb;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }
        
        .verification-checklist {
            background: #ecfdf5;
            border: 1px solid #bbf7d0;
            padding: 20px;
            border-radius: 8px;
            margin-top: 30px;
        }
        
        .checklist-item {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 10px 0;
            padding: 5px 0;
        }
        
        .checklist-item input[type="checkbox"] {
            transform: scale(1.2);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üå± EcoShop Error Fix Verification</h1>
            <p>Testing all browser console error fixes and enhancements</p>
        </div>

        <div class="product-mock">
            <h4>üõçÔ∏è Mock Product: Sustainable Water Bottle</h4>
            <p><strong>EcoScore:</strong> A+ (85/100) | <strong>CO‚ÇÇ:</strong> 2.3kg | <strong>Materials:</strong> Recycled Steel, BPA-Free</p>
        </div>

        <div class="test-section">
            <h3>
                <span class="status-indicator" id="functions-status"></span>
                1. Function Availability Test
            </h3>
            <p>Testing if all ecoShop functions are properly defined and accessible</p>
            
            <button class="test-button cart" onclick="testFunction('ecoShopAddToCart')">
                üõí Test Add to Cart
            </button>
            
            <button class="test-button dashboard" onclick="testFunction('ecoShopOpenDashboard')">
                üìä Test Dashboard
            </button>
            
            <button class="test-button feedback" onclick="testFunction('ecoShopFeedback', 'helpful')">
                üëç Test Feedback
            </button>
            
            <button class="test-button alternatives" onclick="testFunction('ecoShopLoadAlternatives')">
                üîç Test Alternatives
            </button>
            
            <div class="console-output" id="function-output">
                <div>Click buttons above to test function availability...</div>
            </div>
        </div>

        <div class="test-section">
            <h3>
                <span class="status-indicator" id="preload-status"></span>
                2. Preload Optimizer Test
            </h3>
            <p>Testing preload resource optimization and monitoring</p>
            
            <button class="test-button" onclick="testPreloadOptimizer()">
                üöÄ Test Preload Optimizer
            </button>
            
            <button class="test-button" onclick="createTestPreload()">
                ‚ûï Create Test Preload
            </button>
            
            <div class="console-output" id="preload-output">
                <div>Click buttons above to test preload optimization...</div>
            </div>
        </div>

        <div class="test-section">
            <h3>
                <span class="status-indicator" id="error-filter-status"></span>
                3. Error Filtering Test
            </h3>
            <p>Testing console error filtering for third-party noise</p>
            
            <button class="test-button" onclick="testErrorFiltering()">
                üîç Test Error Filtering
            </button>
            
            <button class="test-button" onclick="simulateThirdPartyError()">
                ‚ö†Ô∏è Simulate 3rd Party Error
            </button>
            
            <div class="console-output" id="error-filter-output">
                <div>Click buttons above to test error filtering...</div>
            </div>
        </div>

        <div class="verification-checklist">
            <h3>‚úÖ Verification Checklist</h3>
            <p>Check off each item as you verify the fixes:</p>
            
            <div class="checklist-item">
                <input type="checkbox" id="check1">
                <label for="check1">No "window.ecoShop* is not a function" errors</label>
            </div>
            
            <div class="checklist-item">
                <input type="checkbox" id="check2">
                <label for="check2">All button functions work correctly</label>
            </div>
            
            <div class="checklist-item">
                <input type="checkbox" id="check3">
                <label for="check3">Console shows green success messages</label>
            </div>
            
            <div class="checklist-item">
                <input type="checkbox" id="check4">
                <label for="check4">Preload optimizer reports resource usage</label>
            </div>
            
            <div class="checklist-item">
                <input type="checkbox" id="check5">
                <label for="check5">Third-party errors are filtered (Amazon ads, etc.)</label>
            </div>
            
            <div class="checklist-item">
                <input type="checkbox" id="check6">
                <label for="check6">No "unused preload" warnings</label>
            </div>
        </div>
    </div>

    <script>
        // Set up mock product data for testing
        window.currentProductInfo = {
            name: 'Sustainable Water Bottle',
            url: window.location.href,
            brand: 'EcoBottle Co.',
            category: 'home-kitchen'
        };
        
        window.currentAnalysisData = {
            ecoScore: 85,
            co2Footprint: 2.3,
            materials: ['Recycled Steel', 'BPA-Free Plastic'],
            recyclabilityRating: 'A+'
        };

        // Test function availability
        function testFunction(functionName, param = null) {
            const output = document.getElementById('function-output');
            
            try {
                if (typeof window[functionName] === 'function') {
                    const result = param ? window[functionName](param) : window[functionName]();
                    
                    const message = `‚úÖ SUCCESS: ${functionName} executed successfully`;
                    output.innerHTML += `<div style="color: #10b981;">${message}</div>`;
                    
                    document.getElementById('functions-status').className = 'status-indicator success';
                    
                    console.log(`üå± ${functionName} test passed`);
                } else {
                    throw new Error(`Function ${functionName} is not defined`);
                }
            } catch (error) {
                const message = `‚ùå ERROR: ${functionName} - ${error.message}`;
                output.innerHTML += `<div style="color: #ef4444;">${message}</div>`;
                
                document.getElementById('functions-status').className = 'status-indicator error';
                
                console.error(`üå± ${functionName} test failed:`, error);
            }
            
            output.scrollTop = output.scrollHeight;
        }

        // Test preload optimizer
        function testPreloadOptimizer() {
            const output = document.getElementById('preload-output');
            
            try {
                if (window.ecoShopPreloadOptimizer) {
                    const resources = window.ecoShopPreloadOptimizer.getPreloadedResources();
                    
                    const message = `‚úÖ Preload Optimizer Active - Tracking ${resources.length} resources`;
                    output.innerHTML += `<div style="color: #10b981;">${message}</div>`;
                    
                    resources.forEach(([url, data], index) => {
                        const shortUrl = url.substring(0, 60) + '...';
                        output.innerHTML += `<div>  ${index + 1}. ${shortUrl} (${data.asType})</div>`;
                    });
                    
                    document.getElementById('preload-status').className = 'status-indicator success';
                } else {
                    throw new Error('Preload optimizer not available');
                }
            } catch (error) {
                const message = `‚ùå ERROR: ${error.message}`;
                output.innerHTML += `<div style="color: #ef4444;">${message}</div>`;
                
                document.getElementById('preload-status').className = 'status-indicator error';
            }
            
            output.scrollTop = output.scrollHeight;
        }

        // Create test preload
        function createTestPreload() {
            const output = document.getElementById('preload-output');
            
            try {
                if (window.ecoShopPreloadOptimizer) {
                    const testUrl = 'https://example.com/test-resource.js';
                    window.ecoShopPreloadOptimizer.createOptimizedPreload(testUrl, 'script');
                    
                    const message = `‚úÖ Created test preload: ${testUrl}`;
                    output.innerHTML += `<div style="color: #10b981;">${message}</div>`;
                } else {
                    throw new Error('Preload optimizer not available');
                }
            } catch (error) {
                const message = `‚ùå ERROR: ${error.message}`;
                output.innerHTML += `<div style="color: #ef4444;">${message}</div>`;
            }
            
            output.scrollTop = output.scrollHeight;
        }

        // Test error filtering
        function testErrorFiltering() {
            const output = document.getElementById('error-filter-output');
            
            try {
                // Test that EcoShop errors still show
                console.error('üå± EcoShop: This is a test error - should be visible');
                
                const message = '‚úÖ Error filtering active - EcoShop errors visible in console';
                output.innerHTML += `<div style="color: #10b981;">${message}</div>`;
                
                document.getElementById('error-filter-status').className = 'status-indicator success';
            } catch (error) {
                const message = `‚ùå ERROR: ${error.message}`;
                output.innerHTML += `<div style="color: #ef4444;">${message}</div>`;
                
                document.getElementById('error-filter-status').className = 'status-indicator error';
            }
            
            output.scrollTop = output.scrollHeight;
        }

        // Simulate third-party error
        function simulateThirdPartyError() {
            const output = document.getElementById('error-filter-output');
            
            // This should be filtered if error filtering is working
            console.error('Blocked script execution in amazon-adsystem.com because sandboxed');
            
            const message = '‚ö†Ô∏è Simulated third-party error - should be filtered from console';
            output.innerHTML += `<div style="color: #f59e0b;">${message}</div>`;
            
            output.scrollTop = output.scrollHeight;
        }

        // Check initial state
        window.addEventListener('load', function() {
            // Check if functions are available
            const functionsAvailable = [
                'ecoShopAddToCart',
                'ecoShopOpenDashboard', 
                'ecoShopFeedback',
                'ecoShopLoadAlternatives'
            ].every(fn => typeof window[fn] === 'function');
            
            if (functionsAvailable) {
                document.getElementById('functions-status').className = 'status-indicator success';
            }
            
            // Check if preload optimizer is available
            if (window.ecoShopPreloadOptimizer) {
                document.getElementById('preload-status').className = 'status-indicator success';
            }
            
            // Check if error filtering is active (assume yes if no errors)
            document.getElementById('error-filter-status').className = 'status-indicator success';
            
            console.log('üå± EcoShop Error Fix Verification Page Loaded');
            console.log('Functions available:', {
                ecoShopAddToCart: typeof window.ecoShopAddToCart,
                ecoShopOpenDashboard: typeof window.ecoShopOpenDashboard,
                ecoShopFeedback: typeof window.ecoShopFeedback,
                ecoShopLoadAlternatives: typeof window.ecoShopLoadAlternatives,
                preloadOptimizer: !!window.ecoShopPreloadOptimizer
            });
        });
    </script>
</body>
</html>